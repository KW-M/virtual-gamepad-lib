import{G as q,a as v,g as s,b as y,c as t,C as G,D,d as b}from"./GamepadApiWrapper.8ec8b725.js";import{G as w}from"./GamepadDisplay.1d1c6853.js";const x=["button_1","button_2","button_3","button_4","shoulder_button_front_left","shoulder_button_front_right","shoulder_trigger_back_left","shoulder_trigger_back_right","select_button","start_button","stick_button_left","stick_button_right","d_pad_up","d_pad_down","d_pad_left","d_pad_right"],c=new q(.1),A=new v({buttonConfigs:[],updateDelay:0,axisDeadZone:.05}),E=document.getElementById("gamepads"),f=document.getElementById("gamepad_display_template");let _=[];window.addEventListener("gamepadconnected",i=>{const e=i.gamepad,o=e.index,r=e.emulation;console.info(`Gamepad ${o} connected (${r}): ${e.id}`),k()});window.addEventListener("gamepaddisconnected",i=>{const e=i.gamepad,o=e.index,r=e.emulation;console.info(`Gamepad ${o} disconnected (${r}): ${e.id}`),k()});function L(){for(let i=0;i<_.length;i++){const e=_[i];c.ClearDisplayButtonEventListeners(e.index),c.ClearDisplayJoystickEventListeners(e.index),e.container.remove(),e.display.Cleanup()}_=[]}function k(){L();const i=navigator.getGamepads();for(let e=0;e<i.length;e++){const o=i[e];if(!o)continue;const{display:r,container:l}=M(o.index);_.push({display:r,index:o.index,container:l});const n=o.emulation;(n===s.emulated||n===s.overlay)&&H(o.index,l)}}function T(i,e){i?c.AddEmulatedGamepad(e,!0,D,b):c.AddEmulatedGamepad(-1,!1,D,b)}function H(i,e){const o=x.map((l,n)=>l.includes("trigger")?{buttonIndex:n,type:y.variable,tapTarget:e.querySelector("#"+l+"_touch_target"),dragDistance:50,lockTargetWhilePressed:!0,directions:{[t.up]:!1,[t.down]:!0,[t.left]:!1,[t.right]:!1}}:{buttonIndex:n,type:y.onOff,lockTargetWhilePressed:l.includes("stick"),tapTarget:e.querySelector("#"+l+"_touch_target")});c.AddDisplayButtonEventListeners(i,o);const r=[{tapTarget:e.querySelector("#stick_button_left_touch_target"),dragDistance:30,xAxisIndex:0,yAxisIndex:1,lockTargetWhilePressed:!0,directions:{[t.up]:!0,[t.down]:!0,[t.left]:!0,[t.right]:!0}},{tapTarget:e.querySelector("#stick_button_right_touch_target"),dragDistance:30,xAxisIndex:2,yAxisIndex:3,lockTargetWhilePressed:!0,directions:{[t.up]:!0,[t.down]:!0,[t.left]:!0,[t.right]:!0}}];c.AddDisplayJoystickEventListeners(i,r)}function M(i){if(!f||!E||!f.content.firstElementChild)throw Error("gamepadDisplayTemplate or gamepadDisplaySection elements not found in DOM");const e=f.content.firstElementChild.cloneNode(!0);E.appendChild(e),document.querySelectorAll("#stick_right, #stick_left").forEach(a=>{G(a)});const o=x.map((a,d)=>a.includes("trigger")?{type:y.variable,highlight:e.querySelector("#"+a+"_highlight"),buttonElement:e.querySelector("#"+a),direction:t.down,directionHighlight:e.querySelector("#"+a+"_direction_highlight"),movementRange:10,extraData:{myCustomData:"variable btn name is "+a}}:{type:y.onOff,highlight:e.querySelector("#"+a+"_highlight"),extraData:{myCustomData:"onOff btn name is "+a}}),r=[{joystickElement:e.querySelector("#stick_left"),xAxisIndex:0,yAxisIndex:1,movementRange:10,highlights:{[t.up]:e.querySelector("#l_stick_up_direction_highlight"),[t.down]:e.querySelector("#l_stick_down_direction_highlight"),[t.left]:e.querySelector("#l_stick_left_direction_highlight"),[t.right]:e.querySelector("#l_stick_right_direction_highlight")}},{joystickElement:e.querySelector("#stick_right"),xAxisIndex:2,yAxisIndex:3,movementRange:10,highlights:{[t.up]:e.querySelector("#r_stick_up_direction_highlight"),[t.down]:e.querySelector("#r_stick_down_direction_highlight"),[t.left]:e.querySelector("#r_stick_left_direction_highlight"),[t.right]:e.querySelector("#r_stick_right_direction_highlight")}}],l=new w({gamepadIndex:i,pressedHighlightClass:"pressed",touchedHighlightClass:"touched",moveDirectionHighlightClass:"moved",buttons:o,sticks:r,buttonDisplayFunction:(a,d,u,h,p,m)=>{l.DefaultButtonDisplayFunction(a,d,u,h,p,m)},joystickDisplayFunction:(a,d,u)=>{if(l.DefaultJoystickDisplayFunction(a,d,u),a.xAxisIndex===0){const g=e.querySelector("#l_stick_action_help_label");g&&(g.innerHTML="("+d.toFixed(1)+", "+u.toFixed(1)+")")}else if(a.xAxisIndex===2){const g=e.querySelector("#r_stick_action_help_label");g&&(g.innerHTML="("+d.toFixed(1)+", "+u.toFixed(1)+")")}const h=a.highlights[t.up],p=a.highlights[t.down],m=a.highlights[t.left],S=a.highlights[t.right];h&&(h.style.opacity=Math.max(-u,0).toString()),p&&(p.style.opacity=Math.max(u,0).toString()),m&&(m.style.opacity=Math.max(-d,0).toString()),S&&(S.style.opacity=Math.max(d,0).toString())}},A),n=navigator.getGamepads()[i];return n.emulation===s.emulated?(e.querySelector("#gpad-emulation-label").innerHTML=`gpad #${n.index} | Emulated | ${n.id}`,e.querySelector("#gpad-emulation-btn").innerHTML="REMOVE Emulated Gamepad"):n.emulation===s.overlay?(e.querySelector("#gpad-emulation-label").innerHTML=`gpad #${n.index} | Overlay (real + emulated input) | ${n.id}`,e.querySelector("#gpad-emulation-btn").innerHTML="REMOVE Emulated Gamepad Overlay"):n.emulation===s.real&&(e.querySelector("#gpad-emulation-label").innerHTML=`gpad #${n.index} | Real (no emulated input) | ${n.id} `,e.querySelector("#gpad-emulation-btn").innerHTML="ADD Emulated Gamepad Overlay"),e.querySelector("#gpad-emulation-btn").addEventListener("click",()=>{O(i)}),{container:e,display:l}}function O(i){const e=navigator.getGamepads()[i].emulation;e===s.emulated||e===s.overlay?c.RemoveEmulatedGamepad(i):e===s.real&&T(!0,i)}globalThis.addEmulatedGamepad=()=>{T(!1,-1)};
