import{G as q,a as M,g as c,b as f,c as t,d as w,D as S,e as D}from"./GamepadDisplay.fc5946f3.js";const T=["button_1","button_2","button_3","button_4","shoulder_button_front_left","shoulder_button_front_right","shoulder_trigger_back_left","shoulder_trigger_back_right","select_button","start_button","stick_button_left","stick_button_right","d_pad_up","d_pad_down","d_pad_left","d_pad_right"],r=new q(.1),A=new M({buttonConfigs:[],updateDelay:0}),E=document.getElementById("gamepads"),b=document.getElementById("gamepad_display_template");let y=[];window.addEventListener("gamepadconnected",i=>{const e=i.gamepad,o=e.index,d=e.emulation;console.info(`Gamepad ${o} connected (${d}): ${e.id}`),k()});window.addEventListener("gamepaddisconnected",i=>{const e=i.gamepad,o=e.index,d=e.emulation;console.info(`Gamepad ${o} disconnected (${d}): ${e.id}`),k()});function H(){for(let i=0;i<y.length;i++){const e=y[i];r.ClearDisplayButtonEventListeners(e.index),r.ClearDisplayJoystickEventListeners(e.index),e.container.remove(),e.display.cleanup()}y=[]}function k(){H();const i=navigator.getGamepads();for(let e=0;e<i.length;e++){const o=i[e];if(!o)continue;const{display:d,container:l}=I(o.index);y.push({display:d,index:o.index,container:l});const a=o.emulation;(a===c.emulated||a===c.overlay)&&L(o.index,l)}}function G(i,e){i?r.AddEmulatedGamepad(e,!0,S,D):r.AddEmulatedGamepad(-1,!1,S,D)}function L(i,e){const o=T.map((l,a)=>l.includes("trigger")?{buttonIndex:a,type:f.variable,tapTarget:e.querySelector("#"+l+"_touch_target"),dragDistance:50,lockTargetWhilePressed:!0,directions:{[t.up]:!1,[t.down]:!0,[t.left]:!1,[t.right]:!1}}:{buttonIndex:a,type:f.onOff,lockTargetWhilePressed:l.includes("stick"),tapTarget:e.querySelector("#"+l+"_touch_target")});r.AddDisplayButtonEventListeners(i,o);const d=[{tapTarget:e.querySelector("#stick_button_left_touch_target"),dragDistance:30,xAxisIndex:0,yAxisIndex:1,lockTargetWhilePressed:!0,directions:{[t.up]:!0,[t.down]:!0,[t.left]:!0,[t.right]:!0}},{tapTarget:e.querySelector("#stick_button_right_touch_target"),dragDistance:30,xAxisIndex:2,yAxisIndex:3,lockTargetWhilePressed:!0,directions:{[t.up]:!0,[t.down]:!0,[t.left]:!0,[t.right]:!0}}];r.AddDisplayJoystickEventListeners(i,d)}function I(i){if(!b||!E||!b.content.firstElementChild)throw Error("gamepadDisplayTemplate or gamepadDisplaySection elements not found in DOM");const e=b.content.firstElementChild.cloneNode(!0);E.appendChild(e);const o=T.map((n,s)=>n.includes("trigger")?{type:f.variable,highlight:e.querySelector("#"+n+"_highlight"),buttonElement:e.querySelector("#"+n),direction:t.down,directionHighlight:e.querySelector("#"+n+"_direction_highlight"),movementRange:10,extraData:{myCustomData:"variable btn name is "+n}}:{type:f.onOff,highlight:e.querySelector("#"+n+"_highlight"),extraData:{myCustomData:"onOff btn name is "+n}}),d=[{joystickElement:e.querySelector("#stick_left"),xAxisIndex:0,yAxisIndex:1,movementRange:10,directions:{[t.up]:!0,[t.down]:!0,[t.left]:!0,[t.right]:!0},highlights:{[t.up]:e.querySelector("#l_stick_up_direction_highlight"),[t.down]:e.querySelector("#l_stick_down_direction_highlight"),[t.left]:e.querySelector("#l_stick_left_direction_highlight"),[t.right]:e.querySelector("#l_stick_right_direction_highlight")}},{joystickElement:e.querySelector("#stick_right"),xAxisIndex:2,yAxisIndex:3,movementRange:10,directions:{[t.up]:!0,[t.down]:!0,[t.left]:!0,[t.right]:!0},highlights:{[t.up]:e.querySelector("#r_stick_up_direction_highlight"),[t.down]:e.querySelector("#r_stick_down_direction_highlight"),[t.left]:e.querySelector("#r_stick_left_direction_highlight"),[t.right]:e.querySelector("#r_stick_right_direction_highlight")}}],l=new w({gamepadIndex:i,buttonHighlightClass:"highlight",pressedHighlightClass:"pressed",touchedHighlightClass:"touched",moveDirectionHighlightClass:"moved",buttons:o,sticks:d,buttonDisplayFunction:(n,s,u,h,p,m)=>{l.defaultButtonDisplayFunction(n,s,u,h,p,m)},joystickDisplayFunction:(n,s,u)=>{if(l.defaultJoystickDisplayFunction(n,s,u),n.xAxisIndex===0){const g=e.querySelector("#l_stick_action_help_label");g&&(g.innerHTML="("+s.toFixed(1)+", "+u.toFixed(1)+")")}else if(n.xAxisIndex===2){const g=e.querySelector("#r_stick_action_help_label");g&&(g.innerHTML="("+s.toFixed(1)+", "+u.toFixed(1)+")")}const h=n.highlights[t.up],p=n.highlights[t.down],m=n.highlights[t.left],v=n.highlights[t.right];h&&(h.style.opacity=Math.max(-u,0).toString()),p&&(p.style.opacity=Math.max(u,0).toString()),m&&(m.style.opacity=Math.max(-s,0).toString()),v&&(v.style.opacity=Math.max(s,0).toString())}},A),a=navigator.getGamepads()[i];return a.emulation===c.emulated?(e.querySelector("#gpad-emulation-label").innerHTML=`#${a.index} ${a.id} - Emulated`,e.querySelector("#gpad-emulation-btn").innerHTML="- Emulated Gamepad"):a.emulation===c.overlay?(e.querySelector("#gpad-emulation-label").innerHTML=`#${a.index} ${a.id} - Overlay (real + emulated input)`,e.querySelector("#gpad-emulation-btn").innerHTML="- Emulated Gamepad Overlay"):a.emulation===c.real&&(e.querySelector("#gpad-emulation-label").innerHTML=`#${a.index} ${a.id} - Real (no emulated input)`,e.querySelector("#gpad-emulation-btn").innerHTML="+ Emulated Gamepad Overlay"),e.querySelector("#gpad-emulation-btn").addEventListener("click",()=>{B(i)}),{container:e,display:l}}const B=i=>{const e=navigator.getGamepads()[i].emulation;e===c.emulated||e===c.overlay?r.RemoveEmulatedGamepad(i):e===c.real&&G(!0,i)};let x=0,_;const C=()=>{_?(clearInterval(_),_=null):_=setInterval(()=>{x++;const i=Math.cos(x/100),e=Math.sin(x/100);r.MoveAxis(0,0,i),r.MoveAxis(0,1,e),r.MoveAxis(0,2,-i),r.MoveAxis(0,3,-e);const o=document.getElementById("r_stick_action_help_label");o&&(o.innerHTML="("+-i.toFixed(1)+", "+-e.toFixed(1)+")");const d=Math.floor(Math.random()*S),l=Math.max(i*e*.5,0),a=Math.random()>.8;r.PressButton(0,d,l,a)},10)};globalThis.addEmulatedGamepad=()=>{G(!1,-1)};globalThis.toggleProgramaticGamepadUpdates=C;
